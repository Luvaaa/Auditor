# Database-related issue patterns
patterns:
  - name: "sql-string-concat"
    description: "SQL query built with string concatenation - SQL injection risk"
    regex: "(query|execute|exec|prepare)\\s*\\([^)]*\\+|\"SELECT.*\"\\s*\\+|'SELECT.*'\\s*\\+"
    languages: ["javascript", "typescript", "java", "go", "ruby", "php", "c#"]
    severity: "critical"
    
  - name: "transaction-not-rolled-back"
    description: "Transaction started but no rollback in error path"
    regex: "(BEGIN|START TRANSACTION|beginTransaction|begin_transaction)(?!.*\\b(rollback|ROLLBACK)\\b)"
    languages: ["*"]
    severity: "high"
    
  - name: "missing-db-index-hint"
    description: "Query on non-indexed field (common patterns)"
    regex: "WHERE\\s+(email|username|user_id|created_at|updated_at|status)\\s*="
    languages: ["*"]
    severity: "medium"
    
  - name: "unbounded-query"
    description: "Query without LIMIT clause - potential memory issue"
    regex: "SELECT\\s+.*FROM(?!.*\\bLIMIT\\b)(?!.*\\bTOP\\b)"
    languages: ["*"]
    severity: "medium"
    
  - name: "nested-transaction"
    description: "Nested transaction detected - potential deadlock"
    regex: "(BEGIN|START TRANSACTION).*\\{[^}]*(BEGIN|START TRANSACTION)"
    languages: ["*"]
    severity: "high"
    
  - name: "missing-where-clause-update"
    description: "UPDATE query without WHERE clause - will affect ALL rows"
    regex: "(?i)\\bUPDATE\\s+[\\w\\.]+\\s+SET\\s+(?:(?!\\bWHERE\\b)[^;])+;"
    languages: ["*"]
    severity: "high"
    
  - name: "missing-where-clause-delete"
    description: "DELETE query without WHERE clause - will affect ALL rows"
    regex: "(?i)\\bDELETE\\s+FROM\\s+[\\w\\.]+\\s*(?:(?!\\bWHERE\\b)[^;])*;"
    languages: ["*"]
    severity: "high"
    
  - name: "select-star-query"
    description: "SELECT * query detected - specify needed columns for better performance and stability"
    regex: "(?i)SELECT\\s+\\*\\s+FROM"
    languages: ["*"]
    severity: "low"
